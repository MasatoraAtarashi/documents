# 5/17（木） 18:30 Arch ミーティング


## 出席
- itochan
- tatsu
- mihiro
- lucian
- gentum
- nyatsume
- sodium
- u-dory
- aky
- kumasan
- skyilne
- macchanさん
## Agenda
- 卒論生のテーマとロードマップを共有
  - 学籍番号順で


## u-dory
アマチュア向けに楽器とかの演奏のオーディオパケットをIP伝送する。
前回のタームのブラッシュアップをして行く
ポイントは、
- プロ向けの有線LANで配送するのはある
- アマチュア向けもあったら嬉しいよね
- パケットがドロップしても大丈夫
- AS67は商用のものと互換性がある。
  - 無線で送受信するデータはそのまま流すことができるから嬉しい
- オーディオをパケットにして送ると、ルータとか使える嬉しい
- 中継サーバーを噛ませてデータを解析したり色々できるのが嬉しい

itochanとやりたい。10月の秋祭で村井さんに使ってもらって演奏してもらうという企画をしたら楽しそう。
そこまでにシステムを作りたい

無線でAS67はあまり見かけない
あるのか？
→商用では存在しない、研究でも見かけない
→それはおそらく問題があるから。無線で起こる問題を解決する。手法は色々考えられる。このような環境なら無線でも大丈夫とか。

所信表明である程度あたりをつける
所信表明では問題の定義(解決したい問題を明らかにする)をきちんと言って、どういう手法で解決しようと考えているのか。

itochanとの話について
1対1でできたところを音声をIPで流したら、ミキシングに掛けたりするのをPC上でできないだろうかなど、外でやるのもOK
AS67はmsec単位の遅延
もしかすると国内のクラウドならそれができる可能性もある
1対1の部分(遅延と品質について)はu-doryがやって、ここの部分を音量調整したりリバーブを掛けたり、エフェクターをかけるという部分をitochanやるという手もある。
せっかくIPなので、メンバーがそれぞれ別の場所でやるとかチャレンジングなことをしてみよう

評価としては、u-doryの方は、1対1で遅延がどのくらいかという論文を一本かく。JunMuraiはただのイベント。期限ができるのが良い。

```
やること
無線でAES67実装
Peer to Peer
昨年のもののブラッシュアップ＋α
技術的なあれ
マイコンでお手軽デジタル音声IP送信！
アマチュア向け
多少ドロップしてもいい
家
路上ライブ
AES67
共通規格
受けた先をDanteなどに接続
ミキサーなど市販ツールとの併用
Audio over IP
オーディオデータの解析
中継
合成
何でもできる
音声データを非圧縮で送りまくる頭の悪い感じ
実装しやすい（？）
ESP32
安い
LAN, BT
２コア
I2S
現在
昨年のコードを読み返している
送信機：C (Espressif方言)
受信機：C++ (Arduino方言)
流れ
受信機のブラッシュアップ
Arduinoライブラリを使用した受信機は遅すぎた
とりあえず送信パケットを漏らさないようにはしたい
リングバッファの再実装
ログのとり方の再検討
ここがかなりボトルネックになっていた
ネゴシエーションの実装
現在はハードコーディング
仕様を固めておく
itochanもそれに則れる
I2Sの利用
ここまではパケットの中身がスタブ
Analog Inputならテスト済み
実際に流れている音声データをバッファしてパケットにする
通しテスト
雑多な環境でのテスト
itochanとの協業
```
## mihiro



#### 概要


斎藤さんからテーマをもらった。

#### 所信表明での大まかなストーリー
- ある問題がある（問題）←進捗はここのテーマについてまで
- その問題は重要である（背景）
- こうすればその問題は解けると思ってる（仮説）
- どうしてそう思うのか。理由は〜〜〜（仮説のロジック）
- こういった期間でこういった実験を行う予定である（仮説検証の実験計画）前提・ベーシックに関わる技術的研究がしたい。
→斉藤さんに相談

#### テーマ（問題）内容
- 大規模なデジタルJPYを稼働させるシステムについて
  - 給付を国民が確認できるのか？
  - そもそもスケールできるのか？
  - 政府が数字を誤魔化さないシステム構築は可能なのか？

- デジタル通貨で定期的な引き落としが可能か？
  - Ethereumが既に実現しているためボツ？？

#### 今後
- 頂いたテーマの中から、卒論テーマの決定
- 一度スライドを作ってみる
- 既存論文のResearch（e-gov


既存の日本円と協調できるようなものを考える
想定しているゴールがよく見えない

解決しようとしているテーマが卒論として、大丈夫なのか
あまり大きい問題を扱わないほうがいい
卒論の直前でテーマを変えてやりたいという目線だけで知識もなく突っ込むと大変なことになってしまう、という事例が多々ある

論文で大切なのは社会へのインパクトではない。
問題を見つけて、それを他の方法と比較して、誰がみてもその方法が良い提案手法であると言えれば論として成り立つ。
卒業できることが大切。
解決したい問題をもっと絞り込んだほうがいい。


## itochan

考えていること
u-doryが完成させたAES67 P2P音声伝送システムが使える中継システムを作る

構想


ESP32クライアントを中継するサーバーを実装
クライアントはサーバーに音声信号を伝送する
受け取ってソフトウェアミキサーで処理をしたりエフェクトをかけたりする

どんな論文を書く？？

#### 背景
- 解決したい問題
- これからやること
- 必要な機能を考える

通信方式について話し合う
Wi-FiかBluetoothか
目まぐるしく電波状況が変わる環境ではBluetoothのほうがいいのか？
とりあえずWi-Fiでやってから考えようという感じになった

所信表明対策
中間発表対策

夏休み
u-doryとがんばるらしい

未定：秋祭で村井さんを呼んでセッションする


#### ToDo
- 今の仕組みを調べる
- IPを使うことによってこんなことができるというイメージ
- IPを使うことによって解決できる問題を探す
- 研究するならその分野のことはめちゃめちゃ知ってますという状態にしよう
- 絵が大切
  - この章ではこのような図がないとダメだなっていうことがわかる。
  - 先に図をかくと自分が途中で迷わない
  - 今の図と作りたい未来の図をかく

TimeLimit
"月曜日まで"


u-doryのシステムが当たり前にある中でitochanが解決する問題を考える

## gentam


卒論テーマの草案と現状について．

補足: 今学期卒プロ1をやって，1年間留学の後卒プロ2なので，実質2年間かけてやることになります．

### プロジェクトのゴール
(これから決める何らかのDSL) を簡単にFPGA上で実行できる， オープンなツールチェインを実現する

### 解決したい問題:

FPGA関連のツールチェインには各社が独自に作っているクローズドなものが多い

FPGA上での開発には，ハードウェア関係の知識が必要になり一定のハードルがある

補足: 汎用プログラミング言語を対象にすると，さらに難しくなることと， 特定のアプリケーションを決めた方が最適化ができそうなので，DSLとしています．

### 何を実装するか
(何らかのDSL)を，高位合成を通じてFPGA上に直接実装できるオープンなツールチェイン

ツールチェインとは言っても，論理合成など重要な部分は IceStorm, Yosys, Arachne-pnr によって実装されているため，DSLを中間言語 (firrtl や yosys ilang) まで落とす部分を作る

何らかのDSLのイメージ:

- Network -> P4

- Image processing -> Halide

- ...

### 現在の進捗
- Lattice iCEstick を買った

- IceStorm <http://www.clifford.at/icestorm/> ツールチェインを動かす

- LED点滅 (verilog から)

- 簡易CPU (j1a) 上でforth 処理系を動かす <http://www.excamera.com/sphinx/article-j1a-swapforth.html>

forth のプログラムから:

- LED点滅

- 赤外線を受診したらLED点灯

など

まだ使ってみただけで，各ツールが内部的にどうなってるかは分かっていない．


## aky


### What are you trying to do? Articulate your objectives using absolutely no jargon.
- 組み込み向けWebAssemblyランタイムを実装する
- まずはインタプリタ
- JIT?

### How is it done today, and what are the limits of current practice?
- Arduino 
    - Sketchで開発
    - 言語や環境が限定されている
    - ポータビリティが低い
- JVM
  - Embedded Java -> Java 9 (Jigsaw) でモジュール化
  - OSv
    - ライブラリOS
    - 仮想化用 (Xen, KVM, VMWare, ...)
    - カーネルがJava Bytecodeを食べる
    - 最近は下火 (みんなSeastar作ってるらしい)
- GraalVM
    - 言語実装 (インタプリタ実装) フレームワーク + VM実装 (JITなど)
    - 読む
- .NETとかWindows 10 IoTとか
    - よく知らないので調べる
- PNaCl
    - LLVM bitcodeのサブセットを使ってた

### What is new in your approach and why do you think it will be successful?
- WebAssemblyを使う
    - 中間表現として
        - コンパイラのターゲットになるから汎用性が高い
        - LLVMで最適化済
    - バイナリフォーマットとして
        - ストリーミングでコンパイルできる
        - ネットワーク越しの利用につよい
    - 薄い
        - OS・ハードウェア非依存

### Who cares? If you are successful, what difference will it make?
- ダイナミックな内容を動かしやすくなる
- プロトタイピングとかしやすくなる？

### What are the risks?
- セキュリティ？

### How much will it cost?
- ¥1,361,250

### How long will it take?
- 卒業まで

### What are the mid-term and final “exams” to check for success?
- ネイティブ実行
- できればJVMとかと比較したい

### 実装について
- ESP32関係なくCと標準ライブラリで書いてる
- パーサが8割くらい
- JITは余裕があれば



JVMとか他のものもESP32では動かないと思う

P2Pを考えて、PCもセンサが繋がっている場合もあり、末端のIoTデバイスは、SDが繋がっているものがあり、サーバーとクライアントという風に分けるわけでなく、ストレージで保存までやるものもあれば、しないものもあるというような



## sodium



### やること
RISC-VISAを利用したNPUを開発することにしました
NPUと言ってもDSP的なものではなく、むしろCPUに限りなく近いNPUです


### テーマ
「Ethernet向けSIMD命令を実装したRISC-Vネットワーク・オフロード・コプロセッサの設計と実装」


### ストーリー
「高度なDSPとしての実装による「固まった、変更の利かない」NPUではなく、高速なパイプラインプロセッサと並列SIMD演算を用いたプロセッサ＋ソフトウェアでNPUとして動かす」


### 技術
- 無事に作るものは決まりました(RISC-VISAのNPU)
- 夏の学会に向けてはとりあえず今ありものの32-bit コアを強引に改良して実装予定→メモリからの命令とかはすべて32bit
- 冬までに64bit化してCPUとしての性能も向上したものを実装したいという野望
- MACを超えてネットワークのデータはどの状態で降ってくる？
ヘッダなどのない綺麗な生データで降ってくるならばMACの内側で処理した方が使い勝手のいい装置になる？
- もしヘッダ付きデータを扱うとすれば、ヘッダの分割などをあらかじめハードウェア的に処理しておいた状態でALUに叩き込むのがいい？→「ヘッダとかを分割しない方が柔軟な処理ができるし、とりあえずはそのまま512bitのSIMDにつっこむ形でいいでしょ」by Soraさん

ヘッダもペイロードも含めどこが境目かわからない状態でくる



- NetFPGAへの登録も完了
- PHYチップとつよいFPGAを搭載した大変お強いFPGAボードMACはFPGA内に内蔵、PHYは物理チップとして外付け(ボードの構成上)
- 正直、いまいちネットワーク層について良くわかってなくても最悪IPを利用することでパケット周りの処理についてはなんとかなってしまいそう


### 現在
- NetFPGAはXilinxのFPGAを使用しているので、みんな大好きIntelのQuartus  Primeを捨ててVivadoへの移行を行わざるを得なくなりました→今週は環境構築(物理)と環境構築(論理)を行いましたPYNQを使ってLチカまではできました
- ですが、もともとのパイプライン化したプロセッサでもパイプラインのフラッシュ・ストール対応をしていませんでした(パイプラインコントローラの実装がほぼゼロ)→そのあたりの実装を行っています
- 来週までの目標はパイプライン化したプロセッサで実際に処理を行わせることができる状況にする


### 流れ
1. プロセッサとして動くようにする今のところまだCPUとしてちゃんとデータが流れるかどうかテストしてないので実装・チェック、CPUとしてFPGAに実装して(このCPUを使って)Lチカ
2. (1と並行しながら)NPUとしてのデザイン
3. NPUとしての実装現行のプロセッサの改造及びFIFO及びMACをIPで実装し、データが読める/送れることを確認
4. プログラムの準備何らかの簡単なパケットを改造して再送信するようなプログラムを準備する(要検討)
5. 測定現行のソフトウェア処理との速度比較を行う
